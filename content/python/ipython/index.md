---
tags: ["python", "ipython"]
title: "Ipython"
date: 2022-11-22T07:59:06Z
draft: true
---


## IPythonについて

2001年にフェルナンド・ペレスの片手間のプロジェクトとして始められた。良い対話型のインタプリタを作ることを目的として制作され、2012年にはPythonによる科学技術計算作業の中でなくてはならない位置を占めるように！

IPython自体は何ら計算機能や分析機能を提供するものではないものの、対話的な（インタラクティブな）計算及びツール開発の生産性を向上させるのに大きく役立っている。

IPythonを使用することで、**編集ーコンパイルー実行**サイクルから脱却し、**実行ーデータ探索**サイクルに乗ってデータ分析を進めることができ、またOS及びファイルシステムとも厳密に連携するため、IPythonはそのほとんどの場面で作業の高速化を手助けしてくれる。

<br><br>



## IPython の基本

1. **IPython の起動**
    
    コマンドラインで以下のように入力することで起動
    ```
    $ ipython
    ```

1. **変数の表示**
    
    単に変数名のみを記述し実行した場合にはその変数オブジェクトの文字列表現が返る。特に標準Python環境のprint関数による変数表示と比べ、多くのPythonオブジェクト型が読みやすく、きれいに整形される。

1. **タブ補完**
    
    IPythonにはPython標準インタプリタにはない**タブ補完機能**が搭載されている。
    
    タブ補完の探索範囲は「利用中の名前空間」、「オブジェクト属性」あるいは「モジュール属性」にとどまらず、ユーザがファイル名の一部（のような文字列）を入力してタブ補完した場合、そのコンピュータファイルシステムを大賞に候補を出してくれる。また、関数のキーワード引数に対してもタブ補完することができる！！

    ※デフォルトではIPythonが補完候補に表示しないメソッドや属性がいくつかある。候補表示が乱雑になるのを防ぐため、アンダースコア(_)から始まるマジックメソッドやプライベートメソッド、プライベート属性と言ったものを候補から除外する。これらの候補を明示的に表示したい場合は、IPythonシェルにアンドースコアを入力してタブ補完を呼び出す。これらの候補を常に表示させるように、IPython構成機能で設定することができる。

1. **オブジェクトイントロスペクション**

    変数や関数などの前や後に`?`をつけることでそのオブジェクトの一般情報を見ることができる機能
    - 変数 →　`Type` や 長さ など
    - 関数やインスタンスメソッド　→　存在していれば **ドキュメンテーション文字列（docstring）** が表示される。
        
        ※`?` の代わりに `??` とすると関数のソースコードも表示される

1. **ワイルドカード**

    UNIXやWindowsのコマンドラインシェル上で使用するワイルドカード(`*`)機能を, IPythonでは`?`で使用する。

1. マジックコマンド

    コマンドの先頭が`%`で始まるコマンドのことを**マジックコマンド**とよぶ。IPythonでの特別なコマンドであり、デフォルトでは同名の変数が定義されていない限り`%`を付けなくても実行が可能（automagic(オードマジック)機能）

    |コマンド|説明|
    | --- | --- |
    |%quickref|IPythonのクイックリファレンスを表示|
    |%magic|全マジックコマンドの詳細記述を表示|
    |%lsmagic|利用可能なMagicコマンドの単純な一覧を表示|
    |%debug|対話的デバッガの起動。直前に発生した例外に対して、トレースバックの最下層から開始|
    |%hist|コマンド入力の履歴を表示(オプション指定により出力履歴も表示)|
    |%pdb|例外発生時のデバッガ自動起動の切り替え(ON | OFF)|
    |%paste|クリップボード内の整形済みPythonコード片の実行|
    |%cpaste|クリップボード内Pythonコードの実行のための特別なプロンプトを表示|
    |%reset|名前空間から変数を含めた名前を消去|
    |%page *OBJECT*|引数OBJECTをきれいに表示。ページャを起動|
    |%run *script.py*|引数script.pyをPythonスクリプトとみなしてIPython内で実行。|
    |%prun *statement*|cProfile付きの命令を実行し、プロファイラ出力を表示|
    |%time *statement*|引数で与えられた命令の実行時間を計測|
    |%timeit *statement*|引数で与えられた命令の実行時間を複数回計測。実行時間のごく短い命令の計測に有効|
    |%who, %who_ls, %whos|引数に型名、関数名などを取る。利用中の名前空間の中で定義された、その種類の変数のリストを戻す。3種類の違いは戻り値のフォーマット。%who は単に一覧を戻し、%whos_ls はリストとして戻す。%whos は整形して見やすく表示してくれる。|
    |%xdel *variable|IPython内のオブジェクトを削除し、可能な限りオブジェクトへの参照をも削除する。|

    ※マジックコマンドのヘルプは`%command?`のようにマジックコマンドの後ろに`?`をつけることで確認できる


1. **`%run`**コマンド

    `%run`コマンドを使用するとPythonプログラムを起動することができる。

    ```python
    # ipython_script_test.py ファイルの内容
    def f(x, y, z):
        return(x+y)/z

    a = 5
    b = 8
    c = 7.5

    result = f(a, b, c)
    ```
    このファイルについて以下のようにスクリプトを起動させることでそのスクリプトで定義したあらゆる変数(importしたもの、関数群、グローバル変数)に対して後から参照が可能になる
    ```
    %run ipython_script_test.py
    ```
    ※実行するスクリプトが実行引数(sys.arg)を必要とする場合、スクリプトのファイルパス名の後ろに書く

1. 実行中コードの中断

    IPythonでのあらゆるコード（%run で実行させたスクリプト、長時間実行中となってしまったコマンドなど）の実行中に `Ctrl + C` を押すと KeyboardInterrupt 例外が発生し、ほとんどすべてのPythonプログラムを即時に停止することができる。

    ※実行中コードがコンパイル済みのモジュールを呼び出すケースがあり、そのモジュール内の命令の実行中は Ctrl + C　による停止要求は受け付けられない。こういった場合には制御がインタプリタに戻るまで待つか、OSのタスク管理機能から直接Pythonプロセスを停止させる。

1. クリップボード経由の実行

    クリップボードからのコード片の貼り付けには、多くの環境で`Ctrl + Shift + V`を使用する。ただし空行がある場合にはそこで`return`が押されたものとみなされ問題が発生するため、こういった場合にはマジック関数の `%paste` や `%cpaste` を使う。

    ※`%paste`はクリップボードの中身を1つのブロックとして扱う。`%cpaste` は貼り付け時にプロンプトを出してくれ、`--` または `Ctrl + D` を押すまでペーストを繰り返すことができる。

1. **キーボードショートカット**

    |コマンド|説明|
    | --- | --- |
    |Ctrl-p または ↑|コマンド履歴から入力した文字列で始まるものを遡って検索|
    |Ctrl-n または ↓|コマンド履歴から、入力した文字列で始まるものを時間順に検索|
    |Ctrl-r|コマンド履歴を遡ってのインクリメンタルサーチ（部分一致）|
    |Ctrl-Shift-v|クリップボードから貼り付け|
    |Ctrl-c|実行中コードの中断指示（割り込み）|
    |Ctrl-a|カーソルを行頭へ|
    |Ctrl-e|カーソルを行末へ|
    |Ctrl-k|カーソル位置から行末までのテキストを消去(消去した文字列は`Ctrl-y`で貼り付け可能)|
    |Ctrl-u|現在入力中の行内のすべての文字列を消去（消去した文字列は`Ctrl-y`で貼り付け可能|
    |Ctrl-f|カーソルを一文字分進める|
    |Ctrl-b| カーソルを一文字分戻す|
    |Ctrl-l|画面全体消去|

1. 例外とトレースバック

    IPythonでスクリプトの%runでの実行時、あるいは何らかのPython命令の実行時に例外が発生した場合、**トレースバック**と呼ばれる、その時点の全スタックのトレース情報を生成しそれぞれのスタック情報を表示する際に、その命令の前後数行のコードを含めて表示してくれる。

    前後どの程度の量を表示させるかは`%xmode`マジックコマンドでカスタマイズでき、最小レベル（標準Pythonインタプリタと同等）から冗長レベル（関数の引数値などまで表示）を選択可能。

1. matplotlibとの連携

    IPython を Mtplotlib 機能付きで起動するには以下のようにオプションを指定する。
    これによりIPythonの起動とともにデフォルトで指定されたGUIバックエンド機能が活動化され、これによりmatplotlibウィンドウが描画可能になる。続いてNumpyおよびmatplotlibの主だったパッケージが読み込まれ、名前空間のトップレベルにimportされる。これらの機能は従来のMATLABなどの数値計算パッケージに相当する機能を提供してくれるものである。
    なお、ここまでの流れと同様の準備を手動で行う必要がある場合、マジックコマンドの`%gui`を呼び出すことになる（詳細は`%gui?`でヘルプを確認）
    
    ``` 
    $ ipython --pylab
    ```

1. Qtベースの高機能GUIコンソールの活用

    PyQtやPysideをインストールしている環境（anacondaでもOK!）では高性能なテキストウィジェット、組み込み画像表示、複数行編集、構文ハイライトといった機能群を提供するQtフレームワークでのGUIコンソール機能を使用することができる。
    ```
    $ ipython qtconsole --pylab=inline
    ```
    このQtコンソールでは複数のIPythonプロセスをそれぞれのタブに起動させることができるため、複数の作業を用意に切り替えたり IPython HTML ノートブックとも用意に連携したりできる。

## 補足
### 自作の関数やクラス等を修正した場合のリロードについて
自作の関数やクラスを修正してimportし直しても，ipythonでは反映されない．
反映させるには以下のコマンドを実行！

```ipython
%load_ext autoreload
%autoreload 2
```

- %autoreload は %autoreload が実行される度にインポートしたモジュールをリロードする．
- %autoreload 1 は`%aimport <module>`のコマンドで実行したもの（<module>）のみリロードしてくれる．
- %autoreload 2 は実行する度にインポートしたモジュールをリロードする．

※個人的には`autoreload 2`が使いやすい！

<br><br>




